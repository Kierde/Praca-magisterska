package com.example.project1;import android.app.AlertDialog;import android.content.DialogInterface;import android.content.Intent;import android.os.Bundle;import androidx.annotation.NonNull;import androidx.fragment.app.Fragment;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.ImageView;import android.widget.TextView;import com.firebase.ui.database.FirebaseRecyclerAdapter;import com.firebase.ui.database.FirebaseRecyclerOptions;import com.google.firebase.auth.FirebaseAuth;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import com.squareup.picasso.Picasso;public class WszyscyZnajomi extends Fragment {    RecyclerView listaZnajomych;    DatabaseReference databaseReferenceZanjomi;    DatabaseReference databaseReferenceUzytkownicy;    FirebaseAuth mAuth;    View mainView;    String zalogowanyUser;    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        mainView = inflater.inflate(R.layout.fragment_znajomi, container, false);        listaZnajomych = (RecyclerView) mainView.findViewById(R.id.listaZnajomych);        listaZnajomych.setHasFixedSize(true);        listaZnajomych.setLayoutManager(new LinearLayoutManager(getActivity()));        mAuth = FirebaseAuth.getInstance();        zalogowanyUser = mAuth.getUid();        databaseReferenceZanjomi = FirebaseDatabase.getInstance().getReference().child("Znajomi").child(zalogowanyUser);        databaseReferenceUzytkownicy = FirebaseDatabase.getInstance().getReference().child("Uzytkownicy");        return mainView;    }    @Override    public void onStart(){        super.onStart();        FirebaseRecyclerOptions<Znajomy> options = new FirebaseRecyclerOptions.Builder<Znajomy>()                .setQuery(databaseReferenceZanjomi, Znajomy.class)                .build();        FirebaseRecyclerAdapter<Znajomy, ZnajomyViewHolder> adapter =                new FirebaseRecyclerAdapter<Znajomy, ZnajomyViewHolder>(options){                    @Override                    protected void onBindViewHolder(@NonNull ZnajomyViewHolder holder, int position, @NonNull Znajomy model) {                        holder.data.setText("Znajomość od: "+model.getData());                        String uzytkownikListy = getRef(position).getKey();                        databaseReferenceUzytkownicy.child(uzytkownikListy).addValueEventListener(new ValueEventListener() {                            @Override                            public void onDataChange(@NonNull DataSnapshot snapshot) {                                String nazwaUzytkownika = snapshot.child("nazwaUzytkownika").getValue().toString();                                String zdjecieProfilowe = snapshot.child("zdjecieProfilowe").getValue().toString();                                String plec = snapshot.child("plec").getValue().toString();                                if(plec.equals("true")){                                    holder.plec.setText("Płeć: Mężczyzna");                                }else if(plec.equals("false")){                                    holder.plec.setText("Płeć: Kobieta");                                }                                holder.nazwaUzytkownika.setText("Nazwa użytkownika: "+nazwaUzytkownika);                                if(!zdjecieProfilowe.equals(""))                                Picasso.get().load(zdjecieProfilowe).into(holder.zdjecieProfilowe);                                holder.mView.setOnClickListener(new View.OnClickListener() {                                    @Override                                    public void onClick(View v) {                                        CharSequence opcje[] = new CharSequence[]{"Zobacz profil użytkownika","Wyślij wiadomość", "Zobacz zapis posiłków znajomego", "Zobacz tablicę znajomego" };                                        AlertDialog.Builder builder = new AlertDialog.Builder(getContext());                                        builder.setItems(opcje, new DialogInterface.OnClickListener() {                                            @Override                                            public void onClick(DialogInterface dialog, int which) {                                                if(which==0){                                                    Intent intent = new Intent(getContext(), WyslanieZaproszenia.class );                                                    intent.putExtra("userid",uzytkownikListy );                                                    startActivity(intent);                                                }                                                if(which==1){                                                    Intent intent = new Intent(getContext(), Czat.class );                                                    intent.putExtra("userid", uzytkownikListy );                                                    startActivity(intent);                                                }                                                if(which==2){                                                    Intent intent = new Intent(getContext(), ZapisPosilkow.class);                                                    intent.putExtra("userid", uzytkownikListy );                                                    startActivity(intent);                                                }                                                if(which==3){                                                    Intent intent = new Intent(getContext(), Tablica.class);                                                    intent.putExtra("userid", uzytkownikListy );                                                    startActivity(intent);                                                }                                            }                                        });                                        builder.show();                                    }                                });                            }                            @Override                            public void onCancelled(@NonNull DatabaseError error) {                            }                        });                    }                    @NonNull                    @Override                    public ZnajomyViewHolder onCreateViewHolder(@NonNull ViewGroup viewGroup, int viewType) {                        View view = LayoutInflater.from(viewGroup.getContext()).inflate(R.layout.pojedynczy_uzytkownik,viewGroup, false);                        ZnajomyViewHolder viewHolder = new ZnajomyViewHolder(view);                        return viewHolder;                    }                };        listaZnajomych.setAdapter(adapter);        adapter.startListening();    }    public static class ZnajomyViewHolder extends RecyclerView.ViewHolder{        View mView;        TextView data;        TextView nazwaUzytkownika;        TextView plec;        ImageView zdjecieProfilowe;        public ZnajomyViewHolder(@NonNull View itemView) {            super(itemView);            mView = itemView;            plec = itemView.findViewById(R.id.wiekPoj);            nazwaUzytkownika = itemView.findViewById(R.id.nazwaPojUzytkownika);            data = itemView.findViewById(R.id.statusPoj);            zdjecieProfilowe = itemView.findViewById(R.id.profiloweRozmowa);        }    }}